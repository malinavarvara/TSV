#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö TSV-—Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
–°–æ–∑–¥–∞—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∫–µ–π—Å–∞–º–∏:
- –≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –æ—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π UUID, —É—Ä–æ–≤–µ–Ω—å, –∫–ª–∞—Å—Å –∏ —Ç.–ø.)
- –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ/–∏–∑–±—ã—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫
- –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è
- –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
"""

import os
import uuid
from random import randint, choice
from datetime import datetime

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
HEADER = [
    "n", "mqtt", "invid", "unit_guid", "msg_id", "text", "context",
    "class", "level", "area", "addr", "block", "type", "bit", "invert_bit"
]

ALLOWED_CLASSES = ["alarm", "warning", "info", "event", "comand", "waiting", "working"]
ALLOWED_AREAS = ["LOCAL", "REMOTE"]
ALLOWED_TYPES = ["coil", "register", "discrete", "analog"]

def generate_uuid():
    return str(uuid.uuid4())

def create_tsv_file(filename, rows, header=True):
    """
    –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ rows –≤ TSV-—Ñ–∞–π–ª —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º.
    rows ‚Äî —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤ —Å—Ç—Ä–æ–∫ (–ø–æ 15 –∫–æ–ª–æ–Ω–æ–∫, –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ ‚Äî –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞).
    """
    lines = []
    if header:
        lines.append("\t".join(HEADER))
    for row in rows:
        # –ü—Ä–∏–≤–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫ —Å—Ç—Ä–æ–∫–µ, None –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
        str_row = [str(cell) if cell is not None else "" for cell in row]
        # –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–æ–∫ –º–µ–Ω—å—à–µ 15, –¥–æ–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏
        while len(str_row) < 15:
            str_row.append("")
        # –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–æ–∫ –±–æ–ª—å—à–µ 15, –æ–±—Ä–µ–∑–∞–µ–º (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
        if len(str_row) > 15:
            print(f"‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç {len(str_row)} –∫–æ–ª–æ–Ω–æ–∫, –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞–Ω–∞ –¥–æ 15")
            str_row = str_row[:15]
        lines.append("\t".join(str_row))

    with open(filename, "w", encoding="utf-8") as f:
        f.write("\n".join(lines))
    print(f"‚úÖ –§–∞–π–ª {filename} —Å–æ–∑–¥–∞–Ω, —Ä–∞–∑–º–µ—Ä: {os.path.getsize(filename)} –±–∞–π—Ç")

# -------------------------------------------------------------------------
# 1. –í–∞–ª–∏–¥–Ω—ã–π —Ñ–∞–π–ª —Å —Ä–∞–∑–Ω—ã–º–∏ unit_guid –∏ –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –ø–æ–ª–µ–π
# -------------------------------------------------------------------------
rows_valid_1 = [
    # n, mqtt, invid, unit_guid, msg_id, text, context, class, level, area, addr, block, type, bit, invert_bit
    ["1", "", "G-044999", generate_uuid(), "temp_sensor_alarm", "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã—à–µ –Ω–æ—Ä–º—ã", "–∫–∞–º–µ—Ä–∞ ‚Ññ1",
     "alarm", "150", "LOCAL", "sensors.temp_alarm", "", "coil", "3", "0"],
    ["2", "", "G-044999", generate_uuid(), "fan_status", "–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –≤–∫–ª—é—á—ë–Ω", "",
     "working", "50", "REMOTE", "actuators.fan", "block1", "register", "40001", ""],
    ["3", "", "G-045001", generate_uuid(), "defrost_start", "–ù–∞—á–∞–ª–æ —Ä–∞–∑–º–æ—Ä–æ–∑–∫–∏", "",
     "waiting", "100", "LOCAL", "cold.defrost", "", "", "", ""],
    ["4", "", "G-045001", generate_uuid(), "compressor_on", "–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä –∑–∞–ø—É—â–µ–Ω", "",
     "working", "100", "LOCAL", "cold.compressor", "", "", "", ""],
    ["5", "", "G-045002", generate_uuid(), "leak_detected", "–£—Ç–µ—á–∫–∞ —Ö–ª–∞–¥–∞–≥–µ–Ω—Ç–∞", "",
     "alarm", "250", "REMOTE", "alerts.leak", "", "", "", ""],
]
create_tsv_file("valid_1.tsv", rows_valid_1)

# -------------------------------------------------------------------------
# 2. –ï—â—ë –æ–¥–∏–Ω –≤–∞–ª–∏–¥–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
# -------------------------------------------------------------------------
rows_valid_2 = [
    ["1", "", "G-044999", generate_uuid(), "door_open", "–î–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–∞", "",
     "info", "10", "LOCAL", "status.door", "block2", "coil", "5", "0"],
    ["2", "", "G-044999", generate_uuid(), "door_closed", "–î–≤–µ—Ä—å –∑–∞–∫—Ä—ã—Ç–∞", "",
     "info", "0", "LOCAL", "status.door", "block2", "coil", "5", "1"],
    ["3", "", "G-045003", generate_uuid(), "power_cycle", "–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞", "",
     "event", "0", "REMOTE", "system.power", "block3", "coil", "0", ""],
    ["4", "", "G-045003", generate_uuid(), "remote_command", "–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞", "",
     "comand", "255", "REMOTE", "cmd.remote", "block4", "register", "40010", ""],
]
create_tsv_file("valid_2.tsv", rows_valid_2)

# -------------------------------------------------------------------------
# 3. –§–∞–π–ª —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã, –ø—Ä–æ–ø—É—Å–∫–∏, –ª–∏—à–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏)
# -------------------------------------------------------------------------
rows_invalid = [
    # 1. –í–∞–ª–∏–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
    ["1", "", "G-044999", generate_uuid(), "good_msg", "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ", "",
     "alarm", "100", "LOCAL", "good.addr", "", "coil", "1", "0"],

    # 2. –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π UUID
    ["2", "", "G-044999", "not-a-uuid", "bad_uuid", "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π GUID", "",
     "alarm", "100", "LOCAL", "bad.uuid", "", "", "", ""],

    # 3. –ù–µ—á–∏—Å–ª–æ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å
    ["3", "", "G-044999", generate_uuid(), "bad_level", "–£—Ä–æ–≤–µ–Ω—å –Ω–µ —á–∏—Å–ª–æ", "",
     "alarm", "abc", "LOCAL", "bad.level", "", "", "", ""],

    # 4. –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –∫–ª–∞—Å—Å
    ["4", "", "G-044999", generate_uuid(), "bad_class", "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–ª–∞—Å—Å", "",
     "critical", "100", "LOCAL", "bad.class", "", "", "", ""],

    # 5. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–ª–æ–Ω–æ–∫ (–º–µ–Ω—å—à–µ 4, –Ω–µ—Ç unit_guid)
    ["5", "", "G-044999"],   # –≤—Å–µ–≥–æ 3 –∫–æ–ª–æ–Ω–∫–∏

    # 6. –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ (–ø–æ–ª–Ω–æ—Å—Ç—å—é)
    [],

    # 7. –°—Ç—Ä–æ–∫–∞, –Ω–∞—á–∏–Ω–∞—é—â–∞—è—Å—è —Å # (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π) ‚Äî –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞
    ["# —ç—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –µ–≥–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö"],

    # 8. –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ (16 —à—Ç—É–∫) ‚Äî —Å–µ—Ä–≤–∏—Å –æ–±—Ä–µ–∂–µ—Ç –¥–æ 15
    ["8", "", "G-045005", generate_uuid(), "extra_col", "–õ–∏—à–Ω—è—è –∫–æ–ª–æ–Ω–∫–∞", "", 
     "alarm", "100", "LOCAL", "extra.addr", "", "coil", "2", "0", "–ª–∏—à–Ω–µ–µ_–ø–æ–ª–µ"],

    # 9. –ü—É—Å—Ç–æ–π unit_guid
    ["9", "", "G-045006", "", "empty_guid", "–ü—É—Å—Ç–æ–π GUID", "",
     "warning", "50", "LOCAL", "empty.guid", "", "", "", ""],

    # 10. –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç invert_bit (–Ω–µ –±—É–ª–µ–≤–æ)
    ["10", "", "G-045007", generate_uuid(), "bad_invert", "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–ª–∞–≥", "",
     "info", "0", "LOCAL", "bad.invert", "", "coil", "1", "maybe"],

    # 11. –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å, –Ω–æ –ø–∞—Ä—Å–µ—Ä –≤–æ—Å–ø—Ä–∏–º–µ—Ç –∫–∞–∫ int)
    ["-1", "", "G-045008", generate_uuid(), "neg_line", "–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä", "",
     "info", "0", "LOCAL", "neg.line", "", "", "", ""],
]
create_tsv_file("invalid_format.tsv", rows_invalid)

# -------------------------------------------------------------------------
# 4. –§–∞–π–ª —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º–∏—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ unit_guid
# -------------------------------------------------------------------------
dup_guid = generate_uuid()
rows_duplicate = [
    ["1", "", "G-044999", dup_guid, "dup_msg", "–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ", "",
     "alarm", "100", "LOCAL", "dup.msg1", "", "", "", ""],
    ["2", "", "G-044999", dup_guid, "dup_msg", "–í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ç–æ—Ç –∂–µ msg_id)", "",
     "warning", "80", "LOCAL", "dup.msg2", "", "", "", ""],
    ["3", "", "G-044999", dup_guid, "unique_msg", "–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ", "",
     "info", "50", "LOCAL", "unique.msg", "", "", "", ""],
]
create_tsv_file("duplicate_rows.tsv", rows_duplicate)

# -------------------------------------------------------------------------
# 5. –ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª (1000 —Å—Ç—Ä–æ–∫) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
# -------------------------------------------------------------------------
rows_large = []
for i in range(1, 1001):
    guid = generate_uuid()
    class_ = choice(ALLOWED_CLASSES)
    area_ = choice(ALLOWED_AREAS)
    type_ = choice(ALLOWED_TYPES) if i % 3 == 0 else ""
    bit_ = str(randint(0, 15)) if type_ else ""
    invert_ = str(randint(0, 1)) if bit_ else ""
    rows_large.append([
        str(i), "",
        f"G-{randint(44000, 45000)}",
        guid,
        f"msg_{i}",
        f"–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è {i}",
        f"–∫–æ–Ω—Ç–µ–∫—Å—Ç {i % 5}",
        class_,
        str(randint(0, 250)),
        area_,
        f"device.signal_{i}",
        f"block{i % 10}",
        type_,
        bit_,
        invert_
    ])
create_tsv_file("large_file.tsv", rows_large)

print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã!")
print("üìÇ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Ö –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –∫–æ—Ç–æ—Ä—É—é –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ./incoming).")